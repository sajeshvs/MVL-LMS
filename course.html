<!DOCTYPE html>
<html lang="en" :class="{ 'dark': $store.app.theme === 'dark' }" x-data>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVL-LMS - Course Details</title>
    <script src="https://cdn.tailwindcss.com"></script>    <script>        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mvl-blue': '#1e40af',   // use with border-mvl-blue / text-mvl-blue etc.
                        'mvl-red' : '#dc2626',
                        'mvl-gold': '#f59e0b',
                        'mvl-green': '#059669',
                        'mvl-orange': '#ea580c'
                    }
                }
            }
        };
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/heroicons@2.0.16/24/outline/index.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    <link rel="stylesheet" href="assets/css/overrides.css">
    <script src="assets/js/curriculum-data.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/components.js"></script>
    
    <!-- Theme initialization to prevent flash -->
    <script>
        // Initialize theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">    <!-- MVL LMS Header -->
    <header class="bg-white border-b border-gray-200 dark:bg-gray-900 dark:border-gray-700 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
          
          <!-- Logo and Brand -->
          <div class="flex items-center space-x-3">
            <div class="flex-shrink-0">
              <img src="assets/img/mvl-logo.png" alt="MVL Logo" class="h-10 w-auto logo-mask">
            </div>            <div class="hidden sm:block">
              <h1 class="text-lg font-semibold text-gray-900 dark:text-white">
                Learning Management System
              </h1>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                CMMC 2.0 Training Platform
              </p>
            </div>
          </div>

          <!-- Navigation Links -->
          <nav class="hidden md:flex space-x-8">
            <a href="index.html" class="text-gray-700 hover:text-mvl-blue dark:text-gray-300 dark:hover:text-mvl-blue transition-colors">
              Dashboard
            </a>
            <a href="courses.html" class="text-mvl-blue font-semibold">
              Courses
            </a>            <a href="curriculum.html" class="text-gray-700 hover:text-mvl-blue dark:text-gray-300 dark:hover:text-mvl-blue transition-colors">
              Curriculum
            </a>
            <a href="admin.html" class="text-gray-700 hover:text-mvl-blue dark:text-gray-300 dark:hover:text-mvl-blue transition-colors">
              Admin
            </a>
          </nav>

          <!-- Right Side: Theme Toggle and User Profile -->
          <div class="flex items-center space-x-4">
            
            <!-- Theme Toggle Button -->
            <button id="theme-toggle" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors">
              <svg class="w-5 h-5 text-gray-700 dark:text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                <path class="dark:hidden" fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                <path class="hidden dark:block" d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
              </svg>
            </button>

            <!-- User Profile Dropdown -->
            <div class="relative">
              <button id="user-menu-button" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-mvl-blue" aria-expanded="false" aria-haspopup="true">
                <div class="h-8 w-8 rounded-full bg-mvl-blue flex items-center justify-center">
                  <span class="text-sm font-medium text-white">JD</span>
                </div>
                <span class="ml-2 text-gray-700 dark:text-gray-300 hidden sm:block">John Doe</span>
                <svg class="ml-1 h-4 w-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                </svg>
              </button>
              
              <!-- Dropdown menu -->
              <div id="user-menu" class="hidden absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-md bg-white dark:bg-gray-800 py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                <a href="index.html" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Dashboard</a>
                <button onclick="logout()" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Sign out</button>
              </div>
            </div>

            <!-- Mobile menu button -->
            <div class="md:hidden">
              <button id="mobile-menu-button" class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-mvl-blue">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="hidden md:hidden">
          <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 border-t border-gray-200 dark:border-gray-700">
            <a href="index.html" class="block px-3 py-2 text-gray-700 hover:text-mvl-blue dark:text-gray-300 dark:hover:text-mvl-blue">Dashboard</a>
            <a href="courses.html" class="block px-3 py-2 text-mvl-blue font-semibold">Courses</a>
            <a href="curriculum.html" class="block px-3 py-2 text-gray-700 hover:text-mvl-blue dark:text-gray-300 dark:hover:text-mvl-blue">Curriculum</a>
            <a href="admin.html" class="block px-3 py-2 text-gray-700 hover:text-mvl-blue dark:text-gray-300 dark:hover:text-mvl-blue">Admin</a>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" x-data="courseData()">
        <!-- Breadcrumb -->
        <nav class="flex mb-8" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-4">
                <li>
                    <a href="courses.html" class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300">Courses</a>
                </li>
                <li>
                    <svg class="flex-shrink-0 h-4 w-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                    </svg>
                </li>
                <li>
                    <span class="text-gray-900 dark:text-white font-medium" x-text="course.title">Course Title</span>
                </li>
            </ol>
        </nav>

        <!-- Course Header -->
        <section class="mb-12">
            <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl shadow-lg p-8 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-4">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-500 bg-opacity-30 text-blue-100" x-text="course.id">AC</span>
                            <span x-show="$store.app.isCourseComplete(course.id)"
                                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-500 text-white">
                                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                Complete
                            </span>
                        </div>
                        <h1 class="text-4xl font-bold mb-4" x-text="course.title">Course Title</h1>
                        <p class="text-blue-100 text-lg mb-6" x-text="course.description">Course description goes here</p>
                        
                        <!-- Progress Bar -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between text-sm text-blue-100 mb-2">
                                <span>Course Progress</span>
                                <span x-text="`${courseProgress}% Complete`">0% Complete</span>
                            </div>
                            <div class="w-full bg-blue-500 bg-opacity-30 rounded-full h-3">
                                <div class="bg-white h-3 rounded-full transition-all duration-500"
                                     :style="`width: ${courseProgress}%`"></div>
                            </div>
                        </div>
                        
                        <!-- Course Stats -->
                        <div class="flex items-center space-x-6 text-blue-100">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                                <span x-text="`${lessons.length} Lessons`">0 Lessons</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>~45 minutes</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span x-text="`${completedLessons}/${lessons.length} Complete`">0/0 Complete</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Radar Chart -->
                    <div class="hidden lg:block w-64 h-64">
                        <canvas id="progressRadar"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Course Actions -->
        <section class="mb-8">
            <div class="flex flex-col sm:flex-row gap-4">
                <button @click="startNextLesson()" 
                        x-show="!allLessonsComplete"
                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M19 10a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span x-text="completedLessons === 0 ? 'Start Course' : 'Continue Learning'">Start Course</span>
                </button>
                
                <button @click="markCourseComplete()" 
                        x-show="allLessonsComplete && !$store.app.isCourseComplete(course.id)"
                        class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Mark Course Complete</span>
                </button>
                
                <button class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span>Download Materials</span>
                </button>
            </div>
        </section>

        <!-- Course Resources Section -->
        <section class="mb-8" x-data="courseResources()">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                <div class="px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900 dark:to-indigo-900 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        Reference Materials
                    </h2>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mt-1">Additional resources and documentation for this course</p>
                </div>
                
                <div class="p-6">
                    <div x-show="resources.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <template x-for="resource in resources" :key="resource.url">
                            <a :href="resource.url" 
                               target="_blank" 
                               rel="noopener noreferrer"
                               class="block p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors group">
                                <div class="flex items-start space-x-3">
                                    <svg class="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0 group-hover:text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                                    </svg>
                                    <div class="flex-1 min-w-0">
                                        <h3 class="font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400" 
                                            x-text="resource.title"></h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" 
                                           x-text="resource.description"></p>
                                    </div>
                                    <svg class="w-4 h-4 text-gray-400 flex-shrink-0 mt-1 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                </div>
                            </a>
                        </template>
                    </div>
                    
                    <div x-show="resources.length === 0" class="text-center py-8 text-gray-500 dark:text-gray-400">
                        <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                        </svg>
                        <p>No reference materials available for this course.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Course Syllabus -->
        <section class="mb-12">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Course Syllabus</h2>
                    <p class="text-gray-600 dark:text-gray-300 mt-2">Complete all lessons to master this CMMC domain</p>
                </div>
                
                <div class="divide-y divide-gray-200 dark:divide-gray-700">
                    <template x-for="(lesson, index) in lessons" :key="lesson.id">
                        <div class="px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer"
                             @click="openLesson(lesson.id)">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4 flex-1">
                                    <!-- Lesson Number -->
                                    <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold"
                                         :class="isLessonComplete(lesson.id) ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200'">
                                        <svg x-show="isLessonComplete(lesson.id)" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span x-show="!isLessonComplete(lesson.id)" x-text="index + 1">1</span>
                                    </div>
                                    
                                    <!-- Lesson Details -->
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center space-x-2 mb-1">
                                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white truncate" x-text="lesson.title">Lesson Title</h3>
                                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200" x-text="lesson.id">3.1.1</span>
                                        </div>
                                        <p class="text-gray-600 dark:text-gray-300 text-sm line-clamp-2" x-text="lesson.text">Lesson description goes here</p>
                                        <div class="flex items-center space-x-4 mt-2 text-xs text-gray-500 dark:text-gray-400">
                                            <span class="flex items-center space-x-1">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span>5 min read</span>
                                            </span>
                                            <span class="flex items-center space-x-1">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span>Quiz included</span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Lesson Status -->
                                <div class="flex items-center space-x-3">
                                    <span x-show="isLessonComplete(lesson.id)"
                                          class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                        Complete
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </section>
    </main>    <!-- Footer -->
    <footer id="footer-container"></footer>    <script defer>
        // Header functionality
        document.addEventListener('DOMContentLoaded', function() {          // Theme toggle
          const themeToggle = document.getElementById('theme-toggle');
          const html = document.documentElement;
          
          if (themeToggle) {
            themeToggle.addEventListener('click', function() {
              const isDark = html.classList.contains('dark');
              
              if (isDark) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
              } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
              }
              
              // Update button icon visibility
              updateThemeIcon();
            });
          }
          
          // Update theme icon based on current mode
          function updateThemeIcon() {
            const isDark = html.classList.contains('dark');
            const sunIcon = document.querySelector('#theme-toggle .dark\\:hidden');
            const moonIcon = document.querySelector('#theme-toggle .hidden.dark\\:block');
            
            if (sunIcon && moonIcon) {
              if (isDark) {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
              } else {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
              }
            }
          }
          
          // Initialize theme icon
          updateThemeIcon();
          
          // User menu toggle
          const userMenuButton = document.getElementById('user-menu-button');
          const userMenu = document.getElementById('user-menu');
          
          if (userMenuButton && userMenu) {
            userMenuButton.addEventListener('click', function() {
              userMenu.classList.toggle('hidden');
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
              if (!userMenuButton.contains(event.target) && !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
              }
            });
          }
          
          // Mobile menu toggle
          const mobileMenuButton = document.getElementById('mobile-menu-button');
          const mobileMenu = document.getElementById('mobile-menu');
          
          if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', function() {
              mobileMenu.classList.toggle('hidden');
            });
          }
        });
    </script>

    <script>
        function courseResources() {
            return {
                resources: [],

                init() {
                    this.loadResources();
                },

                loadResources() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const courseId = urlParams.get('id') || 'AC';
                    
                    // Collect all resources from lessons in this course
                    const courseResources = new Map();
                    
                    if (window.LESSONS_DATA) {
                        // Find all lessons for this course
                        Object.keys(window.LESSONS_DATA).forEach(lessonKey => {
                            if (lessonKey.startsWith(courseId + '.')) {
                                const lessonData = window.LESSONS_DATA[lessonKey];
                                if (lessonData.resources && lessonData.resources.length > 0) {
                                    lessonData.resources.forEach(resource => {
                                        // Use URL as key to avoid duplicates
                                        courseResources.set(resource.url, resource);
                                    });
                                }
                            }
                        });
                    }
                    
                    // Convert Map to array
                    this.resources = Array.from(courseResources.values());
                    
                    // Fallback: Add default resources if none found
                    if (this.resources.length === 0) {
                        this.resources = [
                            {
                                title: "CMMC Model Overview",
                                url: "https://www.acq.osd.mil/cmmc/docs/CMMC_Model_Main_20200203.pdf",
                                description: "Official CMMC documentation and requirements"
                            },
                            {
                                title: "NIST SP 800-171r3 Guide",
                                url: "https://nvlpubs.nist.gov/nistpubs/SpecialPublications/800-171r3/NIST.SP.800-171r3.html",
                                description: "Detailed implementation guidance for federal requirements"
                            },
                            {
                                title: "Microsoft 365 Security Documentation",
                                url: "https://docs.microsoft.com/en-us/microsoft-365/security/",
                                description: "Platform-specific security configuration guides"
                            }
                        ];
                    }
                }
            }
        }

        function courseData() {
            return {
                courseId: '',
                course: {},
                lessons: [],
                courseProgress: 0,
                completedLessons: 0,
                allLessonsComplete: false,
                
                init() {
                    this.courseId = getUrlParameter('id') || 'AC';
                    this.loadCourseData();
                    this.calculateProgress();
                    this.initializeChart();
                },
                
                loadCourseData() {
                    const courseMap = {
                        'AC': { id: 'AC', title: 'Access Control', description: 'Control access to systems and data through proper user management and authorization.' },
                        'AT': { id: 'AT', title: 'Awareness & Training', description: 'Build security awareness and train personnel on cybersecurity best practices.' },
                        'AU': { id: 'AU', title: 'Audit & Accountability', description: 'Implement comprehensive auditing and accountability measures for all system activities.' },
                        'CM': { id: 'CM', title: 'Configuration Management', description: 'Establish and maintain secure configurations for all organizational systems.' },
                        'IA': { id: 'IA', title: 'Identification & Authentication', description: 'Implement strong identification and authentication mechanisms for users and devices.' },
                        'IR': { id: 'IR', title: 'Incident Response', description: 'Develop and maintain incident response capabilities to handle security events.' },
                        'MA': { id: 'MA', title: 'Maintenance', description: 'Ensure secure maintenance practices for all organizational systems.' },
                        'MP': { id: 'MP', title: 'Media Protection', description: 'Protect sensitive media containing controlled unclassified information.' },
                        'PS': { id: 'PS', title: 'Personnel Security', description: 'Implement personnel security measures and background screening processes.' },
                        'PE': { id: 'PE', title: 'Physical Protection', description: 'Establish physical security controls to protect facilities and equipment.' },
                        'RA': { id: 'RA', title: 'Risk Assessment', description: 'Conduct regular risk assessments and vulnerability management activities.' },
                        'CA': { id: 'CA', title: 'Security Assessment', description: 'Perform security assessments and implement continuous monitoring.' },
                        'SC': { id: 'SC', title: 'System & Communications Protection', description: 'Protect system communications and implement boundary protection.' },
                        'SI': { id: 'SI', title: 'System & Information Integrity', description: 'Maintain system integrity and protect against malicious code.' }
                    };
                    
                    this.course = courseMap[this.courseId] || courseMap['AC'];
                    
                    // Generate sample lessons for the course
                    this.lessons = this.generateLessons(this.courseId);
                },                generateLessons(courseId) {
                    console.log('Loading lessons for course:', courseId);
                    console.log('Available curriculum data:', window.CURRICULUM_DATA ? 'Available' : 'Missing');
                    
                    // Use the real curriculum data from our expanded curriculum-data.js
                    if (window.CURRICULUM_DATA && window.CURRICULUM_DATA.LESSONS && window.CURRICULUM_DATA.LESSONS[courseId]) {
                        const domainLessons = window.CURRICULUM_DATA.LESSONS[courseId];
                        console.log(`Found ${Object.keys(domainLessons).length} lessons for ${courseId}`);
                        return Object.keys(domainLessons).map(lessonId => ({
                            id: lessonId,
                            title: domainLessons[lessonId].title,
                            text: domainLessons[lessonId].officialRequirement || domainLessons[lessonId].why || 'Course content available',
                            readTime: domainLessons[lessonId].readTime || '5 min read',
                            status: domainLessons[lessonId].status || 'Available'
                        }));
                    }
                    
                    // Try alternative data structure (direct LESSONS_DATA)
                    if (window.LESSONS_DATA) {
                        console.log('Trying LESSONS_DATA structure');
                        const courseLessons = Object.keys(window.LESSONS_DATA)
                            .filter(lessonId => lessonId.startsWith(courseId + '.'))
                            .map(lessonId => ({
                                id: lessonId,
                                title: window.LESSONS_DATA[lessonId].title,
                                text: window.LESSONS_DATA[lessonId].officialRequirement || window.LESSONS_DATA[lessonId].why || 'Course content available',
                                readTime: window.LESSONS_DATA[lessonId].readTime || '5 min read',
                                status: window.LESSONS_DATA[lessonId].status || 'Available'
                            }));
                        
                        if (courseLessons.length > 0) {
                            console.log(`Found ${courseLessons.length} lessons for ${courseId} in LESSONS_DATA`);
                            return courseLessons;
                        }
                    }
                    
                    // Fallback data with accurate lesson counts
                    console.warn(`No curriculum data found for domain ${courseId}, using enhanced fallback`);
                    const enhancedFallbackLessons = {
                        'AC': 22, 'AT': 3, 'AU': 9, 'CM': 9, 'IA': 11, 'IR': 3,
                        'MA': 6, 'MP': 9, 'PS': 2, 'PE': 6, 'RA': 3, 'CA': 2, 'SC': 16, 'SI': 7
                    };
                    
                    const lessonCount = enhancedFallbackLessons[courseId] || 3;
                    const lessons = [];
                    
                    for (let i = 1; i <= lessonCount; i++) {
                        lessons.push({
                            id: `${courseId}.3.1.${i}`,
                            title: `${this.course.title} Requirement ${i}`,
                            text: `Implement ${this.course.title.toLowerCase()} controls and procedures to meet CMMC Level 2 requirements.`,
                            readTime: '5 min read',
                            status: 'Available'
                        });
                    }
                    
                    return lessons;
                },
                
                calculateProgress() {
                    this.completedLessons = this.lessons.filter(lesson => this.isLessonComplete(lesson.id)).length;
                    this.courseProgress = this.lessons.length > 0 ? Math.round((this.completedLessons / this.lessons.length) * 100) : 0;
                    this.allLessonsComplete = this.completedLessons === this.lessons.length && this.lessons.length > 0;
                },
                
                isLessonComplete(lessonId) {
                    return Alpine.store('app').isLessonComplete(this.courseId, lessonId);
                },
                
                startNextLesson() {
                    const nextLesson = this.lessons.find(lesson => !this.isLessonComplete(lesson.id));
                    if (nextLesson) {
                        window.location.href = `lesson.html?domain=${this.courseId}&pr=${nextLesson.id}`;
                    }
                },
                
                openLesson(lessonId) {
                    window.location.href = `lesson.html?domain=${this.courseId}&pr=${lessonId}`;
                },
                
                markCourseComplete() {
                    Alpine.store('app').markCourseComplete(this.courseId);
                    this.calculateProgress();
                },
                
                initializeChart() {
                    this.$nextTick(() => {
                        const ctx = document.getElementById('progressRadar');
                        if (ctx) {
                            new Chart(ctx, {
                                type: 'radar',
                                data: {
                                    labels: ['Understanding', 'Implementation', 'Assessment', 'Compliance', 'Best Practices'],
                                    datasets: [{
                                        label: 'Progress',
                                        data: [this.courseProgress, this.courseProgress * 0.8, this.courseProgress * 0.6, this.courseProgress * 0.9, this.courseProgress * 0.7],
                                        backgroundColor: 'rgba(255, 255, 255, 0.2)',
                                        borderColor: 'rgba(255, 255, 255, 0.8)',
                                        borderWidth: 2,
                                        pointBackgroundColor: 'rgba(255, 255, 255, 1)',
                                        pointBorderColor: 'rgba(255, 255, 255, 0.8)',
                                        pointHoverBackgroundColor: 'rgba(255, 255, 255, 1)',
                                        pointHoverBorderColor: 'rgba(255, 255, 255, 1)'
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            display: false
                                        }
                                    },
                                    scales: {
                                        r: {
                                            beginAtZero: true,
                                            max: 100,
                                            ticks: {
                                                display: false
                                            },
                                            grid: {
                                                color: 'rgba(255, 255, 255, 0.2)'
                                            },
                                            angleLines: {
                                                color: 'rgba(255, 255, 255, 0.2)'
                                            },
                                            pointLabels: {
                                                color: 'rgba(255, 255, 255, 0.8)',
                                                font: {
                                                    size: 10
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
                    });
                }
            }
        }
    </script>
</body>
</html>
